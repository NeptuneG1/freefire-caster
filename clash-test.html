<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Clash Squad Draft</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const client = supabase.createClient(
'https://gkugecflfddkpitlrmws.supabase.co',
'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdrdWdlY2ZsZmRka3BpdGxybXdzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDYwODMwNzQsImV4cCI6MjA2MTY1OTA3NH0.OgQOx9k71DDdK1yOa7VNKGSgoFD9kNGo8j-bR91zGKE'
);


client.auth.getSession().then(({ data: { session } }) => {
if (!session) {
window.location.href = "index.html";
} else {
const userInfo = document.getElementById("user-info");
if (userInfo && session.user?.email) {
userInfo.textContent = "Logged in as: " + session.user.email;
}
}
});


function logout() {
client.auth.signOut().then(() => {
window.location.href = "index.html";
});
}
</script>


<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&family=Roboto&display=swap" rel="stylesheet">
<style>
body { margin: 0; font-family: 'Roboto', sans-serif; background: #0e0e0e; color: #f5f5f5; }
header { background: #1f1f1f; padding: 20px; text-align: center; border-bottom: 3px solid #ffbd59; }
h1 { font-family: 'Orbitron', sans-serif; color: #ffbd59; margin: 0; font-size: 2rem; }
.user-controls { position: absolute; top: 20px; right: 20px; display: flex; align-items: center; gap: 10px; }
.user-controls #user-info { font-size: 14px; color: #ccc; }
.user-controls .logout-btn { background: #ffbd59; color: #1c1c1c; font-weight: bold; padding: 6px 12px; border: none; border-radius: 5px; cursor: pointer; }
.user-controls .logout-btn:hover { background: #e0a84f; }
.draft-wrapper { display: flex; justify-content: center; align-items: flex-start; gap: 50px; margin-top: 20px; flex-wrap: nowrap; }
.team-container { display: flex; flex-direction: column; align-items: center; }
.team-label { background: transparent; border: none; color: #ff7733; font-weight: bold; font-size: 18px; margin-bottom: 10px; text-align: center; }
.team-label:focus { outline: none; border-bottom: 1px dashed #ffbd59; }
.team-row { display: flex; gap: 10px; }
.slot { display: flex; flex-direction: column; align-items: center; gap: 4px; }
.ban-slot, .pick-slot { width: 100px; height: 150px; background: #2a2a2a; border: 2px solid #444; border-radius: 8px; display: flex; justify-content: center; align-items: center; cursor: pointer; position: relative; }
.ban-slot { border-color: #ff5a5a; }
.ban-slot.disabled, .pick-slot.disabled { opacity: 0.4; pointer-events: none; }
.passive-slots, .weapon-slots { display: flex; gap: 3px; justify-content: center; flex-wrap: wrap; }
.passive-slot { width: 25px; height: 50px; background: #3a3a3a; border: 1px solid #555; border-radius: 4px; cursor: pointer; background-size: cover; background-position: center; }
.weapon-slot { width: 100px; height: 40px; background: #868686; border: 2px solid #444; border-radius: 6px; cursor: pointer; display: flex; justify-content: center; align-items: center; position: relative; }
.weapon-slot img { max-height: 100%; max-width: 100%; }
.slot-name { font-size: 12px; color: #ccc; text-align: center; }
.passive-name, .weapon-name { font-size: 10px; color: #ccc; text-align: center; max-width: 40px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; }
.modal { display: none; position: fixed; z-index: 9999; left: 0; top: 0; width: 100%; height: 100%; background: #1f1f1f; overflow: auto; }
.modal-content { background: #1f1f1f; margin: 5% auto; padding: 15px; border: 2px solid #ff7733; border-radius: 8px; width: 90%; max-width: 900px; max-height: 95vh; overflow-y: auto; position: relative; display: flex; flex-direction: column; align-items: center; }
#heroModal h3 { margin-top: 0; font-size: 20px; color: #ff7733; }
teamCard.appendChild(meta);

      const draft = r.state;
      if (draft && draft.picks) {
        const pickIndexes = (team === r.team_left) ? [0, 1, 2, 3] : [7, 6, 5, 4];
        const playerGrid = document.createElement('div');
        playerGrid.style.display = 'flex';
        playerGrid.style.gap = '8px';
        playerGrid.style.marginBottom = '12px';
        playerGrid.style.flexWrap = 'wrap';

        pickIndexes.forEach(i => {
          const hero = draft.picks[i];
          const playerName = draft.playerCards?.[i] || `P${(i % 4) + 1}`;
          const passives = draft.passives?.[i] || [];

          const pCard = document.createElement('div');
          pCard.style.width = '60px';
          pCard.style.textAlign = 'center';
          pCard.style.fontSize = '10px';
          pCard.style.color = '#ccc';
          pCard.style.border = '1px solid #444';
          pCard.style.borderRadius = '6px';
          pCard.style.padding = '4px';

          const heroImg = hero?.image_url || 'https://imgur.com/AdvPwAO.png';
          const heroName = hero?.name || 'None';
          const heroSkill = hero?.skill || '';

          pCard.innerHTML = `
            <img src="${heroImg}" style="width:40px;height:40px;border-radius:4px;"><br>
            <div style="color:#fff; font-weight:bold;">${heroName}</div>
            <div style="color:#bbb;">${playerName}</div>
            <div style="color:#6cf;">${heroSkill}</div>
          `;

          // Add passives below
          passives.forEach(ps => {
            if (ps) {
              const psLine = document.createElement('div');
              psLine.style.display = 'flex';
              psLine.style.alignItems = 'center';
              psLine.style.gap = '2px';
              psLine.style.justifyContent = 'center';
              psLine.style.fontSize = '9px';
              psLine.style.color = '#aaa';

              if (ps.image_url) {
                const img = document.createElement('img');
                img.src = ps.image_url;
                img.style.width = '12px';
                img.style.height = '12px';
                img.style.borderRadius = '2px';
                psLine.appendChild(img);
              }

              const label = document.createElement('span');
              label.textContent = ps.name;
              psLine.appendChild(label);

              pCard.appendChild(psLine);
            }
          });

          playerGrid.appendChild(pCard);
        });

        teamCard.appendChild(playerGrid); // âœ… FIXED HERE
      }
    });

    container.appendChild(teamCard);
  });
}


</script>
</body>
</html>

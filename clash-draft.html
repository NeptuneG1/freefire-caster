<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Free Fire Clash Squad Draft (Final)</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&family=Roboto&display=swap" rel="stylesheet">
<style>
body {margin:0; font-family:'Roboto', sans-serif; background:#0e0e0e; color:#f5f5f5}
header {background:#1f1f1f; padding:15px; text-align:center; border-bottom:3px solid #ff7733}
header h1 {font-family:'Orbitron', sans-serif; color:#ff7733; margin:0; font-size:2rem}
.grid {display:flex; justify-content:center; margin:20px; gap:50px}
.team {display:grid; grid-template-columns:repeat(4,80px); gap:10px}
.player-column {display:flex; flex-direction:column; align-items:center; gap:5px}
.slot {width:70px; height:70px; background:#1f1f1f; border:2px solid #333; border-radius:8px; display:flex; align-items:center; justify-content:center; cursor:pointer}
.slot img {width:100%; height:100%; object-fit:cover; border-radius:6px}
.slot.character {border-color:#00d2ff}
.slot.passive {border-color:#ff59c7}
.slot.weapon {border-color:#ff7733}
.slot.ban {border-color:red}
table {width:90%; margin:20px auto; border-collapse:collapse}
th, td {border:1px solid #555; padding:4px; text-align:center}
#popup {position:fixed; top:10%; left:50%; transform:translateX(-50%); background:#222; padding:15px; border:2px solid #ff7733; border-radius:8px; display:none; z-index:9999; max-width:90%; max-height:70%; overflow:auto}
#popup img {width:50px; height:50px; margin:5px; cursor:pointer; border-radius:5px; border:2px solid #333}
</style>
</head>
<body>
<header><h1>Free Fire Clash Squad Draft</h1></header>
<div class="grid">
<div class="team" id="teamLeft"></div>
<div class="team" id="teamRight"></div>
</div>
<table id="overview"><tr><th>Team</th><th>Player</th><th>Weapons</th><th>Character</th><th>Passives</th></tr></table>
<div id="popup"></div>
<script>
const client = supabase.createClient('https://gkugecflfddkpitlrmws.supabase.co','eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdrdWdlY2ZsZmRka3BpdGxybXdzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDYwODMwNzQsImV4cCI6MjA2MTY1OTA3NH0');
client.auth.getSession().then(({ data: { session } }) => { if(!session) window.location.href="index.html"; });

let players={left:[], right:[]}; let weapons=[], characters=[], bans={left:null,right:null};
for(let t of['left','right']) for(let i=0;i<4;i++) players[t].push({weapons:[null,null],character:null,passives:[null,null,null]});

Promise.all([
 fetch('https://neptuneg1.github.io/freefire-caster/weapon.json').then(r=>r.json()),
 fetch('https://neptuneg1.github.io/freefire-caster/character.json').then(r=>r.json())
]).then(([weaponData, charData]) => { weapons=weaponData; characters=charData; draw(); });

function draw(){['left','right'].forEach(t=>{
 let teamDiv=document.getElementById(t==='left'?'teamLeft':'teamRight');
 teamDiv.innerHTML='';
 teamDiv.appendChild(makeSlot(bans[t],'ban',()=>chooseBan(t)));
 players[t].forEach((p,idx)=>{
  let col=document.createElement('div'); col.className='player-column';
  [0,1].forEach(w=>{let slot=makeSlot(p.weapons[w],'weapon',()=>chooseWeapon(t,idx,w)); col.appendChild(slot);});
  col.appendChild(makeSlot(p.character,'character',()=>chooseCharacter(t,idx)));
  p.passives.forEach((ps,i)=>col.appendChild(makeSlot(ps,'passive',()=>choosePassive(t,idx,i))));
  teamDiv.appendChild(col);
 });
}); updateTable();
}

function makeSlot(val,type,onClick){
 let div=document.createElement('div'); div.className='slot '+type; div.onclick=onClick;
 if(val){let img=document.createElement('img'); img.src=val.image_url||'https://via.placeholder.com/70'; div.appendChild(img);} else div.innerText=type==='weapon'?'W':type==='ban'?'BAN':'+';
 return div;
}

function chooseWeapon(team,player,slot){
 let pop=document.getElementById('popup'); pop.innerHTML='<h3 style="color:#ff7733">Select Weapon</h3>';
 weapons.forEach(w=>{let img=document.createElement('img'); img.src=w.image_url; img.title=w.name;
 img.onclick=()=>{players[team][player].weapons[slot]=w; pop.style.display='none'; draw();}; pop.appendChild(img);});
 pop.style.display='block';
}

function chooseCharacter(team,player){
 let pop=document.getElementById('popup'); pop.innerHTML='<h3 style="color:#00d2ff">Select Character</h3>';
 characters.filter(c=>c.skill_type==='Active').forEach(ch=>{let img=document.createElement('img'); img.src=ch.image_url; img.title=ch.name;
 img.onclick=()=>{players[team][player].character=ch; pop.style.display='none'; draw();}; pop.appendChild(img); });
 pop.style.display='block';
}

function choosePassive(team,player,idx){
 let pop=document.getElementById('popup'); pop.innerHTML='<h3 style="color:#ff59c7">Select Passive Skill</h3>';
 characters.filter(c=>c.skill_type==='Passive').forEach(ch=>{let img=document.createElement('img'); img.src=ch.image_url; img.title=ch.name;
 img.onclick=()=>{players[team][player].passives[idx]=ch; pop.style.display='none'; draw();}; pop.appendChild(img); });
 pop.style.display='block';
}

function chooseBan(team){
 let pop=document.getElementById('popup'); pop.innerHTML='<h3 style="color:red">Ban Active Character</h3>';
 characters.filter(c=>c.skill_type==='Active').forEach(ch=>{let img=document.createElement('img'); img.src=ch.image_url; img.title=ch.name;
 img.onclick=()=>{bans[team]=ch; pop.style.display='none'; draw();}; pop.appendChild(img); });
 pop.style.display='block';
}

function updateTable(){
 let tbl=document.getElementById('overview'); tbl.innerHTML='<tr><th>Team</th><th>Player</th><th>Weapons</th><th>Character</th><th>Passives</th></tr>';
 ['left','right'].forEach(t=>players[t].forEach((p,i)=>{
 tbl.innerHTML+=`<tr><td>${t}</td><td>${i+1}</td><td>${(p.weapons.filter(w=>w).map(w=>w.name).join(', '))||'-'}</td><td>${p.character?p.character.name:'-'}</td><td>${p.passives.filter(p=>p).map(p=>p.name).join(', ')||'-'}</td></tr>`;
 }));
}
</script>
</body>
</html>

<!-- FULL FINAL Free Fire Clash Squad Draft with Reset Buttons -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Free Fire Clash Squad Draft</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&family=Roboto&display=swap" rel="stylesheet">
<style>
body {margin:0; font-family:'Roboto', sans-serif; background:#1c1f26; color:#f0f0f0}
header {background:#1f1f1f; padding:15px; text-align:center; border-bottom:3px solid #ff7733}
header h1 {font-family:'Orbitron', sans-serif; color:#ff7733; margin:0; font-size:2rem}
.draft-wrapper {display:flex; justify-content:space-between; gap:2rem; margin:20px}
.team-column {width:48%; display:flex; flex-direction:column; align-items:center}
.ban-section, .hero-section {display:flex; gap:10px; margin-bottom:20px; flex-wrap:wrap; justify-content:center}
.card {background:#1e1e1e; border:1px solid #444; border-radius:10px; padding:8px; width:100px; text-align:center; display:flex; flex-direction:column; justify-content:center; align-items:center; cursor:pointer}
.card img {width:100%; height:auto; border-radius:6px; object-fit:cover}
table {width:90%; margin:20px auto; border-collapse:collapse; background:#2a2a2a; color:#fff; font-size:0.85rem}
th, td {border:1px solid #444; padding:8px; text-align:center}
#popup {position:fixed; top:10%; left:50%; transform:translateX(-50%); background:#222; padding:15px; border:2px solid #ff7733; border-radius:10px; display:none; z-index:9999; max-height:70%; overflow:auto}
#popup img {margin:5px; cursor:pointer; border-radius:5px; border:2px solid #333}
#popup.weapon img {width:150px; height:60px}
#popup.character img, #popup.passive img {width:80px; height:120px}
.reset-btn {margin-top:5px; padding:4px 8px; background:#ff7733; color:#fff; border:none; border-radius:4px; cursor:pointer}
</style>
</head>
<body>
<header><h1>Free Fire Clash Squad Draft</h1></header>
<div class="draft-wrapper">
<div class="team-column"><div class="ban-section" id="teamLeftBan"></div><div class="hero-section" id="teamLeft"></div></div>
<div class="team-column"><div class="ban-section" id="teamRightBan"></div><div class="hero-section" id="teamRight"></div></div>
</div>
<table id="overview"><tr><th>Team</th><th>Player</th><th>Weapons</th><th>Character</th><th>Passives</th></tr></table>
<div id="popup"></div>
<script>
const client = supabase.createClient('https://gkugecflfddkpitlrmws.supabase.co','eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdrdWdlY2ZsZmRka3BpdGxybXdzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDYwODMwNzQsImV4cCI6MjA2MTY1OTA3NH0');
client.auth.getSession().then(({ data: { session } }) => { if(!session) window.location.href="index.html"; });

let players={left:[], right:[]}; let weapons=[], characters=[], bans={left:null,right:null};
for(let t of['left','right']) for(let i=0;i<4;i++) players[t].push({weapons:[null,null],character:null,passives:[null,null,null]});

Promise.all([
 fetch('https://neptuneg1.github.io/freefire-caster/weapon.json').then(r=>r.json()),
 fetch('https://neptuneg1.github.io/freefire-caster/character.json').then(r=>r.json())
]).then(([weaponData, charData]) => { weapons=weaponData; characters=charData; draw(); });

function draw(){
 document.getElementById('teamLeftBan').innerHTML='';
 document.getElementById('teamRightBan').innerHTML='';
 document.getElementById('teamLeft').innerHTML='';
 document.getElementById('teamRight').innerHTML='';
 ['left','right'].forEach(t=>{
 document.getElementById(t==='left'?'teamLeftBan':'teamRightBan').appendChild(makeCard(bans[t],'ban',()=>chooseBan(t)));
 players[t].forEach((p,idx)=>{
  let col=document.createElement('div'); col.style.display='flex'; col.style.flexDirection='column'; col.style.alignItems='center'; col.style.gap='5px';
  [0,1].forEach(w=>{col.appendChild(makeCard(p.weapons[w],'weapon',()=>chooseWeapon(t,idx,w)));});
  col.appendChild(makeCard(p.character,'character',()=>chooseCharacter(t,idx)));
  p.passives.forEach((ps,i)=>col.appendChild(makeCard(ps,'passive',()=>choosePassive(t,idx,i))));
  let resetBtn=document.createElement('button');
  resetBtn.className='reset-btn';
  resetBtn.innerText='Reset';
  resetBtn.onclick=()=>{players[t][idx]={weapons:[null,null],character:null,passives:[null,null,null]}; draw();};
  col.appendChild(resetBtn);
  document.getElementById(t==='left'?'teamLeft':'teamRight').appendChild(col);
 });
}); updateTable();
}

function makeCard(val,type,onClick){
 let div=document.createElement('div'); div.className='card'; div.onclick=onClick;
 let defaultImg='https://imgur.com/AdvPwAO.png';
 if(val){let img=document.createElement('img'); img.src=val.image_url||defaultImg; div.appendChild(img);} else div.innerText=type==='weapon'?'W':type==='ban'?'BAN':'+';
 return div;
}

function chooseWeapon(team,player,slot){
 let pop=document.getElementById('popup'); pop.className=''; pop.classList.add('weapon'); pop.innerHTML='<h3 style="color:#ff7733">Select Weapon</h3>';
 weapons.forEach(w=>{let img=document.createElement('img'); img.src=w.image_url; img.title=w.name;
 img.onclick=()=>{players[team][player].weapons[slot]=w; pop.style.display='none'; draw();}; pop.appendChild(img);});
 pop.style.display='block';
}

function chooseCharacter(team,player){
 let pop=document.getElementById('popup'); pop.className=''; pop.classList.add('character'); pop.innerHTML='<h3 style="color:#00d2ff">Select Character</h3>';
 let used = [].concat(...['left','right'].map(t=>players[t].map(p=>p.character?.name))).filter(Boolean);
 let banned = Object.values(bans).filter(Boolean).map(b => b.name);
 characters.filter(c=>c.skill_type==='Active').forEach(ch=>{
   let img=document.createElement('img'); img.src=ch.image_url; img.title=ch.name;
   if(used.includes(ch.name) || banned.includes(ch.name)) {
     img.style.opacity='0.4'; img.style.pointerEvents='none';
   } else {
     img.onclick=()=>{players[team][player].character=ch; pop.style.display='none'; draw();};
   }
   pop.appendChild(img);
 });
 pop.style.display='block';
}

function choosePassive(team,player,idx){
 let pop=document.getElementById('popup'); pop.className=''; pop.classList.add('passive'); pop.innerHTML='<h3 style="color:#ff59c7">Select Passive Skill</h3>';
 characters.filter(c=>c.skill_type==='Passive').forEach(ch=>{let img=document.createElement('img'); img.src=ch.image_url; img.title=ch.name;
 img.onclick=()=>{players[team][player].passives[idx]=ch; pop.style.display='none'; draw();}; pop.appendChild(img); });
 pop.style.display='block';
}

function chooseBan(team){
 let pop=document.getElementById('popup'); pop.className=''; pop.classList.add('character'); pop.innerHTML='<h3 style="color:red">Ban Active Character</h3>';
 characters.filter(c=>c.skill_type==='Active').forEach(ch=>{let img=document.createElement('img'); img.src=ch.image_url; img.title=ch.name;
 img.onclick=()=>{bans[team]=ch; pop.style.display='none'; draw();}; pop.appendChild(img); });
 pop.style.display='block';
}

function updateTable(){
 let tbl=document.getElementById('overview'); tbl.innerHTML='<tr><th>Team</th><th>Player</th><th>Weapons</th><th>Character</th><th>Passives</th></tr>';
 ['left','right'].forEach(t=>players[t].forEach((p,i)=>{
 let weaponDetails=p.weapons.filter(w=>w).map(w=>w.name+': '+(w.description||'-')).join('<br>')||'-';
 let passiveDetails=p.passives.filter(ps=>ps).map(ps=>ps.name+': '+(ps.description||'-')).join('<br>')||'-';
 tbl.innerHTML+=`<tr><td>${t}</td><td>${i+1}</td><td>${weaponDetails}</td><td>${p.character?(p.character.name+': '+(p.character.description||'-')):'-'}</td><td>${passiveDetails}</td></tr>`;
 }));
}
</script>
</body>
</html>
